

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spectrum Generation &mdash; python 81a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dummy Equations" href="../dummy.html" />
    <link rel="prev" title="Spectra Files" href="spectrum_files.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> python
          

          
          </a>

          
            
            
              <div class="version">
                81
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input.html">Inputs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../output.html">Outputs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostic files</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectra_files.html">Spectra Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum_files.html">Spectra Files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Spectrum Generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dummy.html">Dummy Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evaluation.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta.html">Meta-documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../output.html">Outputs</a> &raquo;</li>
        
      <li>Spectrum Generation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/output/spectrum_generation_large_optical_depth.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spectrum-generation">
<h1>Spectrum Generation<a class="headerlink" href="#spectrum-generation" title="Permalink to this headline">¶</a></h1>
<p>With the current machinery to create spectra, it is possible to come across the
situation where models with large optical depths or wind velocities generate
spectra with different flux normalisation depending on the wavelength range.</p>
<p>This problem was originally encountered whilst modelling Tidal Disruption Events.
Two spectra for the same model were generated over two wavelength ranges; a
restricted (1100 - 2600 A) and a broader (500 - 5000 A) range. The problem
encountered was that the broad range spectrum had <em>more</em> flux than the spectrum
with the restricted range. The figure below shows the same model, but over two
wavelength ranges - as well as two spectra where the maximum number of scatters
a photon can undergo is changed,</p>
<ul class="simple">
<li><p><strong>tde_flux_small_range:</strong> The restricted wavelength range</p></li>
<li><p><strong>tde_flux_large_range:</strong> The broad wavelength range</p></li>
<li><p><strong>tde_flux_small_range_maxscat:</strong> The restricted wavelength range with a value <code class="code docutils literal notranslate"><span class="pre">MAXSCAT</span> <span class="pre">=</span> <span class="pre">50</span></code></p></li>
<li><p><strong>tde_flux_no_maxscat:</strong> The restricted wavelength range with no <code class="code docutils literal notranslate"><span class="pre">MAXSCAT</span></code> limit</p></li>
</ul>
<div class="figure align-default" id="id4">
<img alt="../_images/spectrum_generation_large_optical_depth.png" src="../_images/spectrum_generation_large_optical_depth.png" />
<p class="caption"><span class="caption-text">Example spectra showing differing flux totals</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The problem here is not caused by a bug with the code, but is a consequence of
the large wind velocities and optical depths of the model. We currently believe
that there are two reasons why the flux differs between these two wavelength ranges.</p>
<div class="section" id="doppler-shifting-out-of-the-spectrum-wavelength-range">
<h2>Doppler Shifting out of the Spectrum Wavelength Range<a class="headerlink" href="#doppler-shifting-out-of-the-spectrum-wavelength-range" title="Permalink to this headline">¶</a></h2>
<p>At the edges of the restricted spectrum above, the flux is reduced. This is
due to photon frequencies being shifted outside of the wavelength range of the
spectrum. If a significant number of photons are removed from the spectrum
in this way, then the following Error is printed,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_create</span><span class="p">:</span> <span class="n">Fraction</span> <span class="n">of</span> <span class="n">photons</span> <span class="n">lost</span><span class="p">:</span> <span class="mf">0.10</span> <span class="n">wi</span><span class="o">/</span> <span class="n">freq</span><span class="o">.</span> <span class="n">low</span><span class="p">,</span> <span class="mf">0.19</span> <span class="n">w</span><span class="o">/</span><span class="n">freq</span> <span class="n">hi</span>
</pre></div>
</div>
<p>This tells one the fraction of the photon sample which does not contribute towards
the spectrum due to to the photon frequencies being larger or smaller than the
defined spectrum range, due to Doppler shifting. In models with large wind
velocities (0.2 - 0.5 c) and a small spectral range, the fraction of photons lost
is large and the flux at the edge of generated spectra is reduced - as can be
seen above in the above figure. However, when the wind has a more moderate velocity,
the number of photons lost due to being shifted out of the range is much lower and
does not produce a noticeable effect on the flux normalisation of the spectra.</p>
</div>
<div class="section" id="removing-photons-due-to-too-many-scatters">
<h2>Removing Photons due to Too Many Scatters<a class="headerlink" href="#removing-photons-due-to-too-many-scatters" title="Permalink to this headline">¶</a></h2>
<p>As well as edge effects, flux can be lost due to photons being removed from the
photon sample due to scattering too many times. In Python, when a photon has undergone
<cite>MAXSCAT = 500</cite> scatters, a photon is assumed to have become stuck in the wind
and hence it is terminated and no longer tracked.</p>
<p>In models with large optical depths, the number of photons terminated in this way
can become large. During spectrum generation, these photons will never fully
escape the system but will only contribute partially to the spectrum due to
extract - they will never contribute if Live or Die is used instead.</p>
<p>At current, there is no logic to detect this and hence no error is given. However,
it is often insightful to read the output from the <cite>Photons contribution to the
various spectra</cite> table, as shown below,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Photons</span> <span class="n">contributing</span> <span class="n">to</span> <span class="n">the</span> <span class="n">various</span> <span class="n">spectra</span>
<span class="n">Inwind</span>   <span class="n">Scat</span>    <span class="n">Esc</span>     <span class="n">Star</span>    <span class="o">&gt;</span><span class="n">nscat</span>    <span class="n">err</span>    <span class="n">Absorb</span>   <span class="n">Disk</span>    <span class="n">sec</span>    <span class="n">Adiab</span><span class="p">(</span><span class="n">matom</span><span class="p">)</span>
     <span class="mi">0</span>       <span class="mi">0</span>    <span class="mi">3455</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>       <span class="mi">0</span>    <span class="mi">3455</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>       <span class="mi">0</span>     <span class="mi">427</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>       <span class="mi">0</span>    <span class="mi">1598</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>       <span class="mi">0</span>    <span class="mi">1430</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>       <span class="mi">0</span>    <span class="mi">3313</span>       <span class="mi">0</span>   <span class="mi">17209</span>       <span class="mi">0</span>     <span class="mi">169</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>  <span class="mi">282914</span>  <span class="mi">487831</span>    <span class="mi">1474</span>       <span class="mi">0</span>       <span class="mi">0</span>     <span class="mi">129</span>  <span class="mi">223605</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>  <span class="mi">441756</span>  <span class="mi">336514</span>    <span class="mi">2223</span>       <span class="mi">0</span>       <span class="mi">0</span>     <span class="mi">135</span>  <span class="mi">215325</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>  <span class="mi">609395</span>  <span class="mi">180082</span>    <span class="mi">5677</span>       <span class="mi">0</span>       <span class="mi">0</span>      <span class="mi">94</span>  <span class="mi">200705</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>  <span class="mi">750672</span>   <span class="mi">61308</span>   <span class="mi">12010</span>       <span class="mi">0</span>       <span class="mi">0</span>      <span class="mi">59</span>  <span class="mi">171904</span>       <span class="mi">0</span>       <span class="mi">0</span>
     <span class="mi">0</span>  <span class="mi">838923</span>   <span class="mi">26143</span>   <span class="mi">29057</span>       <span class="mi">0</span>       <span class="mi">0</span>      <span class="mi">55</span>  <span class="mi">101775</span>       <span class="mi">0</span>       <span class="mi">0</span>
</pre></div>
</div>
<p>In the above table, one can see that 17,209 photons which scattered more than
MAXSCAT times contributed to the the scattered spectrum, suggesting that a large
number of photons were terminated due to too many scatters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The photon numbers presented in this table are only for the master MPI process. Hence, if
running in multiprocessor mode, the number here will never equal the total
number of photons in the simulation, but only the number of photons in the current
process.</p>
</div>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Link to wiki entry on information about the spectral files when created</p>
</div>
</div>
<div class="section" id="issue">
<h2>Issue<a class="headerlink" href="#issue" title="Permalink to this headline">¶</a></h2>
<p>The original GitHub issue discussing this problem can be found here; <a href="#id2"><span class="problematic" id="id3">:issue:`471`</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dummy.html" class="btn btn-neutral float-right" title="Dummy Equations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spectrum_files.html" class="btn btn-neutral float-left" title="Spectra Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Knox Long, Christian Knigge, Stuart Sims, Nick Higginbottom, James Matthews, Sam Mangham, Edward Parkinson, Mandy Hewitt

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>